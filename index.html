<!DOCTYPE html>
<html>
<head>
	<script src="./data/konva.min.js"></script>
	<meta charset="utf-8" />
	<title>Konva Sprite Demo</title>

</head>
<body>
	<table style="position:absolute; left:400px">
		<thead><tr><th>工作日志：</th><tr></thead>
		<tbody>
			<tr><td>（2022年9月30日）滑鼠左键讓角色改變位置</td></tr>
			<tr><td>（2022年9月29日）角色動作顯示，以按鈕方式測試</td></tr>
			<tr><td>（2022年9月28日）擬定計劃，設計仙劍破壞神網頁游戲</td></tr>
		</tbody>
	</table>
	<button id="atk">物理攻擊</button>
	<button id="matk">法術攻擊</button>
	<button id="def">防禦</button>
	<button id="hurt">受到攻擊</button>
	<button id="dead">死亡</button>
	<div id="container"></div>
</body>
<script>

	let test_a;
  var width = window.innerWidth;
  var height = window.innerHeight;

  var stage = new Konva.Stage({
	container: 'container',
	width: width,
	height: height,
  });

  var layer = new Konva.Layer();
  var animations = {
	idle: [
	  // x, y, width, height (1 frames)
	  0, 0, 56,63
	],
	atk: [
	  // x, y, width, height (3 frames)
		7*56,0, 56,63,  468,0,56,63,    523,0, 56,63,  
	],
	matk: [
	  // x, y, width, height (3 frames)
		5*56,0, 56,63, 6*56,0, 56,63,  
	],
	def: [
	  // x, y, width, height (1 frames)
		3*56,0, 56,63,   
	],
	hurt: [
	  // x, y, width, height (1 frames)
		 4*56,0, 56,63,   
	],
	dead: [
	  // x, y, width, height (1 frames)
		 2*56,0, 56,63,   
	],
  };

  var imageObj = new Image();
  imageObj.onload = function () {
	var blob = new Konva.Sprite({
	  x: 100,
	  y: 100,
	 
	  image: imageObj,
	  animation: 'idle',
	  animations: animations,
	  frameRate: 7,
	  frameIndex: 0,
	});

	// add the shape to the layer
	layer.add(blob);

	// add the layer to the stage
	stage.add(layer);

	// start sprite animation
	blob.start();
	test_a=blob;
	// resume transition
	document.getElementById('atk').addEventListener('click', 
		function () {
			blob.animation('atk');
			blob.on('frameIndexChange.button', function () {
				if (this.frameIndex() === 2) {
					setTimeout(function () {
						blob.animation('idle');
						blob.off('.button');
					}, 1000 / blob.frameRate());
				}
			});
		},
		false
	);
	document.getElementById('matk').addEventListener('click', 
		function () {
			blob.animation('matk');
			blob.on('frameIndexChange.button', function () {
				if (this.frameIndex() === 1) {
					setTimeout(function () {
						blob.animation('idle');
						blob.off('.button');
					}, 1000 / blob.frameRate());
				}
			});
		},
		false
	);
	document.getElementById('hurt').addEventListener('click', 
		function () {
			blob.animation('hurt');
			if (blob.frameIndex() == 0) {
				setTimeout(function () {
					blob.animation('idle');
					blob.off('.button');
				}, 1000 / blob.frameRate());
			}
		},
		false
	);
	document.getElementById('dead').addEventListener('click', 
		function () {
			blob.animation('dead');
			
		},false);
	document.getElementById('def').addEventListener('click', function () {blob.animation('def');},false);
  };
  imageObj.src = './data/img/zhaolinger.png';
  stage.addEventListener('mousedown', function(evt) {
	mousePos = {x: evt.clientX-56/2,y: evt.clientY-63};	
	test_a.position(mousePos);
}, false);
</script>
</html>
